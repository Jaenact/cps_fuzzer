# =====================================================
# 5. Documentation - 문서 자동 생성
# API 문서 및 README 검증
# =====================================================
name: Documentation

on:
  push:
    branches: [main]
    paths:
      - "**.py"
      - "docs/**"
      - "README.md"
  pull_request:
    branches: [main]

permissions:
  contents: read

jobs:
  docs:
    name: Build Documentation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Documentation Tools
        run: |
          pip install pdoc3 mkdocs mkdocs-material

      - name: Generate API Documentation
        run: |
          mkdir -p docs/api
          pdoc --html --output-dir docs/api \
            core fuzzers mutators monitors protocols harness \
            --force || echo "::warning::Some modules failed to document"

      - name: Upload Documentation Artifact
        uses: actions/upload-artifact@v6
        with:
          name: api-documentation
          path: docs/
          retention-days: 7

  readme-check:
    name: README Validation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Check README Links
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: "yes"
          config-file: ".github/mlc_config.json"
        continue-on-error: true
